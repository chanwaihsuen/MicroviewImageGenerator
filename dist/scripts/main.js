var canvas=document.getElementById("drawer"),context=canvas.getContext("2d"),imageDataArray=[];$(document).ready(function(){createMapper(),loadImagePath("./images/testimage.png"),$("#imgInput").change(function(e){loadImagePath(URL.createObjectURL(e.target.files[0]))})});var loadImagePath=function(e){context.fillStyle="#FFF",context.fillRect(0,0,64,48),imageDataArray=[];var t=0,a=0,r=0,n=0,o=0,i=0,g=0,c=new Image;c.onload=function(){t=c.width,a=c.height,r=64/c.width,n=48/c.height,o=n>r?r:n,i=(64-c.width*o)/2,g=(48-c.height*o)/2,context.drawImage(c,i,g,c.width*o,c.height*o),pixelToScreen(),getArdunioCode()},c.src=e},createMapper=function(){for(var e=10,t=0;48>t;t++)for(var a=0;64>a;a++)$("<div/>",{id:"c"+t+"_"+a,style:"top:"+t*e+"px; left: "+a*e+"px;","class":"cell"}).appendTo("#mapper")},getArdunioCode=function(){for(var e="",t="const unsigned char logo [] = { \r\n",a=0;a<imageDataArray.length;a++)e=parseInt(imageDataArray[a],2).toString(16).toUpperCase(),e=e.length>1?"0x"+e:"0x0"+e,t+=a%16===0&&0!==a?"\r\n":"",t+=e+", ";t=t.substr(0,t.length-2)+" \r\n};",$("#outputText").html(t)},codeToString=function(){$("#codedImage").html("");for(var e=0;e<imageDataArray.length;e++)$("<div/>",{id:"cc"+e,html:imageDataArray[e],"class":"codedCell"}).appendTo("#codedImage")},pixelToScreen=function(){for(var e=context.getImageData(0,0,64,48),t=0,a=0,r=0,n=0,o=0,i=0,g=[],c=0,d=e.data.length;d>c;c+=4){if(r=e.data[c],n=e.data[c+1],o=e.data[c+2],i=(r+n+o)/3,i=i>127?255:0,$("#c"+a+"_"+t).css({"background-color":"rgb("+i+", "+i+", "+i+")"}),t%64===0&&a%8===0&&0!==a){for(var l=0;l<g.length;l++)imageDataArray.push(reverseString(g[l]));g=[]}"string"!=typeof g[t]&&(g[t]=""),g[t]+=255===i?"0":"1",t++,t%64===0&&(t=0,a++)}for(var l=0;l<g.length;l++)imageDataArray.push(reverseString(g[l]))},reverseString=function(e){return e.split("").reverse().join("")};